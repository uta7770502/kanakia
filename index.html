<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>æ”¾èª²å¾Œå…ç«¥ã‚¯ãƒ©ãƒ– æ´»å‹•ãƒŠãƒ“</title>
<style>
  :root{
    --bg:#f5f6f8;
    --card:#fff;
    --shadow:0 10px 22px rgba(0,0,0,.08);
    --header:#4fc3c7;
    --accent:#2fb34a;
    --accent2:#1aa65a;
    --line:#e9edf2;
    --text:#222;
    --muted:#6b7280;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif;
    background:var(--bg);
    color:var(--text);
  }
  header{
    background:var(--header);
    color:#fff;
    text-align:center;
    padding:18px 14px;
    font-size:22px;
    font-weight:900;
    letter-spacing:.02em;
  }
  .wrap{ max-width: 980px; margin: 0 auto; padding: 14px 16px 26px; }

  /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä½œæˆãƒœã‚¿ãƒ³ */
  .start-wrap{
    display:flex;
    justify-content:center;
    margin: 10px 0 18px;
  }
  .start-btn{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:min(720px, 100%);
    border:none;
    border-radius:999px;
    padding:18px 18px;
    font-size:20px;
    font-weight:900;
    cursor:pointer;
    color:#fff;
    background:linear-gradient(135deg,var(--accent),var(--accent2));
    box-shadow:0 14px 26px rgba(47,179,74,.25);
  }
  .start-btn:active{ transform: translateY(1px); }

  /* 9ã‚¢ã‚¤ã‚³ãƒ³ã‚°ãƒªãƒƒãƒ‰ */
  .grid{
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 18px;
  }
  .item{
    background:var(--card);
    border-radius:18px;
    padding:18px 10px 16px;
    box-shadow: var(--shadow);
    text-align:center;
    cursor:pointer;
    user-select:none;
    border:1px solid rgba(233,237,242,.9);
  }
  .item:active{ transform: translateY(1px); }
  .icon{
    width:92px;
    height:92px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:42px;
    margin: 0 auto 10px;
  }
  .label{
    font-size:18px;
    font-weight:900;
  }

  /* è‰² */
  .bg-orange{ background:#ff8a65; }
  .bg-purple{ background:#9575cd; }
  .bg-teal  { background:#4db6ac; }
  .bg-yellow{ background:#fbc02d; }
  .bg-green { background:#81c784; }
  .bg-brown { background:#ffb74d; }
  .bg-blue  { background:#64b5f6; }
  .bg-lime  { background:#aed581; }
  .bg-gray  { background:#90a4ae; }

  /* ===== ãƒ¢ãƒ¼ãƒ€ãƒ« ===== */
  .modal{
    position:fixed;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    padding:18px;
    background:rgba(0,0,0,.35);
    z-index:9999;
  }
  .modal.show{ display:flex; }
  .modal-card{
    width:min(700px, 100%);
    background:#fff;
    border-radius:18px;
    box-shadow:0 18px 40px rgba(0,0,0,.2);
    overflow:hidden;
  }
  .modal-head{
    padding:14px 14px 12px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    border-bottom:1px solid var(--line);
  }
  .modal-title{
    display:flex; align-items:center; gap:10px;
    font-weight:900;
    font-size:16px;
  }
  .badge{
    width:38px;height:38px;border-radius:50%;
    display:flex;align-items:center;justify-content:center;
    font-size:18px;
  }
  .modal-body{ padding:14px; }
  .help{
    color:var(--muted);
    font-size:12px;
    line-height:1.6;
    margin:0 0 10px;
  }

  .actions{
    display:grid;
    grid-template-columns: repeat(2, 1fr);
    gap:12px;
  }
  .act{
    border:1px solid var(--line);
    background:#fff;
    border-radius:16px;
    padding:12px;
    display:flex;
    gap:10px;
    align-items:center;
    box-shadow:0 6px 14px rgba(0,0,0,.06);
  }
  .act-emo{
    width:42px;height:42px;border-radius:14px;
    display:flex;align-items:center;justify-content:center;
    font-size:20px;
    flex:0 0 auto;
  }
  .act-name{ font-weight:900; font-size:14px; line-height:1.2; }
  .act-sub{ font-size:12px; color:var(--muted); margin-top:2px; }
  .act-del{
    margin-left:auto;
    border:none;
    background:#fff;
    color:#ef4444;
    font-weight:900;
    cursor:pointer;
    padding:8px 10px;
    border-radius:12px;
    border:1px solid var(--line);
    display:none;
  }

  .modal-foot{
    padding:12px 14px 14px;
    border-top:1px solid var(--line);
    display:flex;
    justify-content:space-between;
    gap:10px;
    flex-wrap:wrap;
  }
  .btn{
    border:none;
    border-radius:12px;
    padding:10px 12px;
    font-weight:900;
    cursor:pointer;
  }
  .btn.primary{
    color:#fff;
    background:linear-gradient(135deg,var(--accent),var(--accent2));
  }
  .btn.ghost{
    background:#fff;
    border:1px solid var(--line);
    color:#111;
  }
  .btn.danger{
    background:#fff;
    border:1px solid rgba(239,68,68,.35);
    color:#ef4444;
  }

  /* ç·¨é›†ã‚¨ãƒªã‚¢ */
  .editor{
    margin-top:12px;
    padding-top:12px;
    border-top:1px dashed var(--line);
    display:none;
  }
  .editor.show{ display:block; }
  .form{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:10px;
    margin-top:10px;
  }
  .field{
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  .field label{ font-size:12px; color:var(--muted); font-weight:900; }
  .field input{
    border:1px solid var(--line);
    border-radius:12px;
    padding:10px 12px;
    font-weight:700;
  }
  .form .full{ grid-column: 1 / -1; }
  .editor-actions{
    display:flex;
    gap:10px;
    margin-top:10px;
    flex-wrap:wrap;
  }

  /* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ™‚ */
  .editing .act-del{ display:inline-flex; }
  .editing .help-edit{ display:block; }
  .help-edit{ display:none; margin-top:8px; }

  @media (max-width:420px){
    .grid{ gap:14px; }
    .icon{ width:84px;height:84px;font-size:40px; }
    .label{ font-size:17px; }
    .actions{ grid-template-columns: 1fr; }
    .form{ grid-template-columns: 1fr; }
  }
</style>
</head>

<body>
<header>æ”¾èª²å¾Œå…ç«¥ã‚¯ãƒ©ãƒ– æ´»å‹•ãƒŠãƒ“</header>

<div class="wrap">
  <div class="start-wrap">
    <button class="start-btn" id="toCalendar">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä½œæˆ</button>
  </div>

  <div class="grid" id="grid"></div>
</div>

<!-- ===== ãƒ¢ãƒ¼ãƒ€ãƒ« ===== -->
<div class="modal" id="modal">
  <div class="modal-card" role="dialog" aria-modal="true">
    <div class="modal-head">
      <div class="modal-title">
        <div class="badge" id="modalBadge">ğŸ¯</div>
        <div id="modalTitle">ã‚¸ãƒ£ãƒ³ãƒ«</div>
      </div>
      <button class="btn ghost" id="closeBtn">é–‰ã˜ã‚‹</button>
    </div>

    <div class="modal-body" id="modalBody">
      <p class="help" id="modalHelp">ã“ã®ã‚¸ãƒ£ãƒ³ãƒ«ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§ã§ã™ã€‚</p>
      <p class="help help-edit" id="editHelp">ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ï¼šå³ã®ã€Œå‰Šé™¤ã€ã§æ¶ˆã›ã¾ã™ã€‚ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã§è¿½åŠ ã§ãã¾ã™ã€‚</p>

      <div class="actions" id="actions"></div>

      <div class="editor" id="editor">
        <div class="form">
          <div class="field">
            <label>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³åï¼ˆä¾‹ï¼šã¬ã‚Šçµµï¼‰</label>
            <input id="inLabel" placeholder="ä¾‹ï¼šã¬ã‚Šçµµ" />
          </div>
          <div class="field">
            <label>çµµæ–‡å­—ï¼ˆä¾‹ï¼šğŸ–ï¸ï¼‰</label>
            <input id="inEmoji" placeholder="ä¾‹ï¼šğŸ–ï¸" />
          </div>
          <div class="field full">
            <label>è£œè¶³ï¼ˆä»»æ„ï¼šä¾‹ï¼šè¡¨ç¾ï¼‰</label>
            <input id="inSub" placeholder="ä¾‹ï¼šè¡¨ç¾ï¼ˆä»»æ„ï¼‰" />
          </div>
        </div>

        <div class="editor-actions">
          <button class="btn primary" id="addActionBtn">ï¼‹ è¿½åŠ </button>
          <button class="btn danger" id="resetBtn">åˆæœŸçŠ¶æ…‹ã«æˆ»ã™</button>
        </div>
      </div>
    </div>

    <div class="modal-foot">
      <button class="btn ghost" id="editBtn">ç·¨é›†</button>
      <button class="btn ghost" id="backBtn">ã“ã®ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</button>
    </div>
  </div>
</div>

<script>
/* ============================
   ã‚¸ãƒ£ãƒ³ãƒ«å®šç¾©ï¼ˆaction.htmlã¨åŒã˜æ€æƒ³ï¼‰
============================ */
const GENRES = [
  { id:"sport",  label:"é‹å‹•",     emoji:"ğŸƒ", iconBg:"bg-orange" },
  { id:"finger", label:"æŒ‡å…ˆèª²é¡Œ", emoji:"âœ‹", iconBg:"bg-purple" },
  { id:"focus",  label:"é›†ä¸­èª²é¡Œ", emoji:"ğŸ§ ", iconBg:"bg-teal" },
  { id:"craft",  label:"å·¥ä½œ",     emoji:"ğŸ¨", iconBg:"bg-yellow" },
  { id:"cook",   label:"æ–™ç†",     emoji:"ğŸ³", iconBg:"bg-green" },
  { id:"snack",  label:"ãŠã‚„ã¤ä½œã‚Š", emoji:"ğŸª", iconBg:"bg-brown" },
  { id:"rule",   label:"ãƒ«ãƒ¼ãƒ«ã‚²ãƒ¼ãƒ ", emoji:"ğŸ²", iconBg:"bg-blue" },
  { id:"life",   label:"ç”Ÿæ´»å­¦ç¿’", emoji:"ğŸ ", iconBg:"bg-lime" },
  { id:"out",    label:"å¤–å‡º",     emoji:"ğŸšŒ", iconBg:"bg-gray" },
];

const DEFAULT_ACTIONS = {
  sport:[
    { id:"sport-run",   label:"ã‹ã‘ã£ã“", emoji:"ğŸƒâ€â™‚ï¸", sub:"ä½“åŠ›ã¥ãã‚Š" },
    { id:"sport-ball",  label:"ãƒœãƒ¼ãƒ«éŠã³", emoji:"âš½ï¸", sub:"å”èª¿ãƒ»ãƒ«ãƒ¼ãƒ«" },
    { id:"sport-dance", label:"ãƒ€ãƒ³ã‚¹", emoji:"ğŸ’ƒ", sub:"ãƒªã‚ºãƒ ãƒ»è¡¨ç¾" },
    { id:"sport-gym",   label:"ã‚µãƒ¼ã‚­ãƒƒãƒˆ", emoji:"ğŸ¤¸", sub:"é‹å‹•æ©Ÿèƒ½" },
    { id:"sport-walk",  label:"æ•£æ­©", emoji:"ğŸš¶", sub:"æ°—åˆ†è»¢æ›" },
    { id:"sport-game",  label:"é‹å‹•ã‚²ãƒ¼ãƒ ", emoji:"ğŸ¸", sub:"æ¥½ã—ãé‹å‹•" },
  ],
  finger:[
    { id:"finger-cut",  label:"ã¯ã•ã¿", emoji:"âœ‚ï¸", sub:"å·§ç·»æ€§" },
    { id:"finger-fold", label:"æŠ˜ã‚Šç´™", emoji:"ğŸ“„", sub:"æ‰‹é †ãƒ»é›†ä¸­" },
    { id:"finger-bead", label:"ã²ã‚‚é€šã—", emoji:"ğŸ§µ", sub:"æŒ‡å…ˆæ“ä½œ" },
    { id:"finger-peg",  label:"æ´—æ¿¯ã°ã•ã¿", emoji:"ğŸ“", sub:"ã¤ã¾ã‚€ç·´ç¿’" },
    { id:"finger-clay", label:"ç²˜åœŸ", emoji:"ğŸ§±", sub:"æ¡ã‚‹ãƒ»ã“ã­ã‚‹" },
    { id:"finger-puzzle",label:"ãƒ‘ã‚ºãƒ«", emoji:"ğŸ§©", sub:"å½¢åˆã‚ã›" },
  ],
  focus:[
    { id:"focus-worksheet", label:"ãƒ¯ãƒ¼ã‚¯", emoji:"ğŸ“", sub:"æœºä¸Šèª²é¡Œ" },
    { id:"focus-maze",      label:"è¿·è·¯", emoji:"ğŸŒ€", sub:"æ³¨æ„ãƒ»è¨ˆç”»" },
    { id:"focus-math",      label:"æ•°ã‚ãã³", emoji:"ğŸ”¢", sub:"æ•°æ¦‚å¿µ" },
    { id:"focus-letter",    label:"ã“ã¨ã°", emoji:"ğŸ”¤", sub:"æ–‡å­—" },
    { id:"focus-memory",    label:"è¨˜æ†¶ã‚²ãƒ¼ãƒ ", emoji:"ğŸ§ ", sub:"è¨˜æ†¶ãƒ»é›†ä¸­" },
    { id:"focus-time",      label:"æ™‚è¨ˆ", emoji:"ğŸ•’", sub:"æ™‚é–“ç†è§£" },
  ],
  craft:[
    { id:"craft-paint", label:"ã¬ã‚Šçµµ", emoji:"ğŸ–ï¸", sub:"è¡¨ç¾" },
    { id:"craft-paper", label:"ç´™å·¥ä½œ", emoji:"ğŸ“", sub:"åˆ¶ä½œ" },
    { id:"craft-season",label:"å­£ç¯€åˆ¶ä½œ", emoji:"ğŸ", sub:"è¡Œäº‹" },
    { id:"craft-collage",label:"ã‚³ãƒ©ãƒ¼ã‚¸ãƒ¥", emoji:"ğŸ“°", sub:"è²¼ã‚‹" },
    { id:"craft-mask",  label:"ãŠé¢", emoji:"ğŸ­", sub:"ã”ã£ã“éŠã³" },
    { id:"craft-card",  label:"ã‚«ãƒ¼ãƒ‰ä½œã‚Š", emoji:"ğŸ’Œ", sub:"ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ" },
  ],
  cook:[
    { id:"cook-sand", label:"ã‚µãƒ³ãƒ‰", emoji:"ğŸ¥ª", sub:"ã‹ã‚“ãŸã‚“èª¿ç†" },
    { id:"cook-salad",label:"ã‚µãƒ©ãƒ€", emoji:"ğŸ¥—", sub:"æ··ãœã‚‹" },
    { id:"cook-onigiri",label:"ãŠã«ãã‚Š", emoji:"ğŸ™", sub:"æ¡ã‚‹" },
    { id:"cook-soup", label:"ã‚¹ãƒ¼ãƒ—", emoji:"ğŸ²", sub:"æ‰‹é †" },
    { id:"cook-egg",  label:"ãŸã¾ã”", emoji:"ğŸ³", sub:"åŠ ç†±" },
    { id:"cook-fruit",label:"ãƒ•ãƒ«ãƒ¼ãƒ„", emoji:"ğŸ", sub:"åˆ‡ã‚‹" },
  ],
  snack:[
    { id:"snack-cookie", label:"ã‚¯ãƒƒã‚­ãƒ¼", emoji:"ğŸª", sub:"ã“ã­ã‚‹" },
    { id:"snack-jelly",  label:"ã‚¼ãƒªãƒ¼", emoji:"ğŸ®", sub:"å†·ã‚„ã™" },
    { id:"snack-parfait",label:"ãƒ‘ãƒ•ã‚§", emoji:"ğŸ¨", sub:"ç››ã‚Šä»˜ã‘" },
    { id:"snack-pancake",label:"ãƒ›ãƒƒãƒˆã‚±ãƒ¼ã‚­", emoji:"ğŸ¥", sub:"ç„¼ã" },
    { id:"snack-choco",  label:"ãƒãƒ§ã‚³", emoji:"ğŸ«", sub:"å›ºã‚ã‚‹" },
    { id:"snack-popcorn",label:"ãƒãƒƒãƒ—ã‚³ãƒ¼ãƒ³", emoji:"ğŸ¿", sub:"æ¥½ã—ã„" },
  ],
  rule:[
    { id:"rule-card",   label:"ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ", emoji:"ğŸƒ", sub:"é †ç•ª" },
    { id:"rule-board",  label:"ãƒœãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ", emoji:"ğŸ²", sub:"ãƒ«ãƒ¼ãƒ«" },
    { id:"rule-karuta", label:"ã‹ã‚‹ãŸ", emoji:"ğŸ€„ï¸", sub:"èã" },
    { id:"rule-jenga",  label:"ãƒãƒ©ãƒ³ã‚¹", emoji:"ğŸ§±", sub:"æ‰‹å…ˆ" },
    { id:"rule-word",   label:"ã—ã‚Šã¨ã‚Š", emoji:"ğŸ—£ï¸", sub:"è¨€è‘‰" },
    { id:"rule-team",   label:"ãƒãƒ¼ãƒ æˆ¦", emoji:"ğŸ¤", sub:"å”åŠ›" },
  ],
  life:[
    { id:"life-clean",   label:"æƒé™¤", emoji:"ğŸ§¹", sub:"ç‰‡ä»˜ã‘" },
    { id:"life-laundry", label:"æ´—æ¿¯", emoji:"ğŸ‘•", sub:"ãŸãŸã‚€" },
    { id:"life-money",   label:"ãŠé‡‘", emoji:"ğŸ’´", sub:"è²·ã„ç‰©ç·´ç¿’" },
    { id:"life-traffic", label:"äº¤é€š", emoji:"ğŸš¦", sub:"å®‰å…¨" },
    { id:"life-manner",  label:"ãƒãƒŠãƒ¼", emoji:"ğŸ™‡", sub:"ç¤¾ä¼šæ€§" },
    { id:"life-time",    label:"æ™‚é–“", emoji:"â°", sub:"äºˆå®š" },
  ],
  out:[
    { id:"out-park",    label:"å…¬åœ’", emoji:"ğŸ›", sub:"éŠå…·" },
    { id:"out-walk",    label:"æ•£ç­–", emoji:"ğŸŒ¿", sub:"è‡ªç„¶" },
    { id:"out-library", label:"å›³æ›¸é¤¨", emoji:"ğŸ“š", sub:"é™ã‹ã«" },
    { id:"out-shop",    label:"è²·ã„ç‰©", emoji:"ğŸ›’", sub:"å®Ÿè·µ" },
    { id:"out-museum",  label:"è¦‹å­¦", emoji:"ğŸ›ï¸", sub:"å­¦ã³" },
    { id:"out-train",   label:"ä¹—ã‚Šç‰©", emoji:"ğŸšƒ", sub:"ä½“é¨“" },
  ],
};

const grid = document.getElementById("grid");
const modal = document.getElementById("modal");
const modalBadge = document.getElementById("modalBadge");
const modalTitle = document.getElementById("modalTitle");
const actionsEl = document.getElementById("actions");
const editor = document.getElementById("editor");

const editBtn = document.getElementById("editBtn");
const closeBtn = document.getElementById("closeBtn");
const backBtn = document.getElementById("backBtn");

const inLabel = document.getElementById("inLabel");
const inEmoji = document.getElementById("inEmoji");
const inSub = document.getElementById("inSub");
const addActionBtn = document.getElementById("addActionBtn");
const resetBtn = document.getElementById("resetBtn");

let currentGenreId = null;
let isEditing = false;

function storageKey(genreId){
  return `kanakia_actions_${genreId}`;
}
function loadActions(genreId){
  try{
    const raw = localStorage.getItem(storageKey(genreId));
    if(!raw) return structuredClone(DEFAULT_ACTIONS[genreId] || []);
    const parsed = JSON.parse(raw);
    if(!Array.isArray(parsed)) return structuredClone(DEFAULT_ACTIONS[genreId] || []);
    return parsed;
  }catch(e){
    return structuredClone(DEFAULT_ACTIONS[genreId] || []);
  }
}
function saveActions(genreId, actions){
  localStorage.setItem(storageKey(genreId), JSON.stringify(actions));
}

function renderGrid(){
  grid.innerHTML = "";
  GENRES.forEach(g=>{
    const card = document.createElement("div");
    card.className = "item";
    card.innerHTML = `
      <div class="icon ${g.iconBg}">${g.emoji}</div>
      <div class="label">${g.label}</div>
    `;
    card.addEventListener("click", ()=>openModal(g.id));
    grid.appendChild(card);
  });
}

function setEditing(on){
  isEditing = on;
  editor.classList.toggle("show", on);
  document.getElementById("modalBody").classList.toggle("editing", on);
  editBtn.textContent = on ? "ç·¨é›†ã‚’çµ‚ã‚ã‚‹" : "ç·¨é›†";
}

function openModal(genreId){
  currentGenreId = genreId;
  const g = GENRES.find(x=>x.id===genreId);
  if(!g) return;

  modalBadge.textContent = g.emoji;
  modalBadge.className = `badge ${g.iconBg}`;
  modalTitle.textContent = `${g.label}ï½œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§`;

  setEditing(false);
  renderActions();
  modal.classList.add("show");
}

function closeModal(){
  modal.classList.remove("show");
  currentGenreId = null;
  setEditing(false);
  // å…¥åŠ›æ¬„ãƒªã‚»ãƒƒãƒˆ
  inLabel.value = "";
  inEmoji.value = "";
  inSub.value = "";
}

function renderActions(){
  if(!currentGenreId) return;
  const g = GENRES.find(x=>x.id===currentGenreId);
  const list = loadActions(currentGenreId);

  actionsEl.innerHTML = "";
  if(list.length === 0){
    const p = document.createElement("p");
    p.className = "help";
    p.textContent = "ã¾ã ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ç·¨é›†ã‹ã‚‰è¿½åŠ ã§ãã¾ã™ã€‚";
    actionsEl.appendChild(p);
    return;
  }

  list.forEach((a, idx)=>{
    const row = document.createElement("div");
    row.className = "act";
    row.innerHTML = `
      <div class="act-emo ${g.iconBg}">${a.emoji || "âœ…"}</div>
      <div>
        <div class="act-name">${escapeHtml(a.label || "ï¼ˆåç§°ãªã—ï¼‰")}</div>
        <div class="act-sub">${escapeHtml(a.sub || "")}</div>
      </div>
      <button class="act-del" title="å‰Šé™¤">å‰Šé™¤</button>
    `;
    const del = row.querySelector(".act-del");
    del.addEventListener("click", ()=>{
      if(!confirm("ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
      const next = list.filter((_,i)=>i!==idx);
      saveActions(currentGenreId, next);
      renderActions();
    });

    actionsEl.appendChild(row);
  });
}

function addAction(){
  if(!currentGenreId) return;
  const label = (inLabel.value || "").trim();
  const emoji = (inEmoji.value || "").trim();
  const sub   = (inSub.value || "").trim();

  if(!label){
    alert("ã‚¢ã‚¯ã‚·ãƒ§ãƒ³åã‚’å…¥ã‚Œã¦ã­");
    return;
  }

  const list = loadActions(currentGenreId);
  // idã¯é›‘ã§OKï¼ˆé‡è¤‡ã—ã«ãã„ï¼‰
  const id = `${currentGenreId}-${Date.now()}`;
  list.push({ id, label, emoji: emoji || "âœ…", sub });
  saveActions(currentGenreId, list);

  inLabel.value = "";
  inEmoji.value = "";
  inSub.value = "";

  renderActions();
}

function resetActions(){
  if(!currentGenreId) return;
  if(!confirm("ã“ã®ã‚¸ãƒ£ãƒ³ãƒ«ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆæœŸçŠ¶æ…‹ï¼ˆ6å€‹ï¼‰ã«æˆ»ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) return;
  localStorage.removeItem(storageKey(currentGenreId));
  renderActions();
}

/* utils */
function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* events */
document.getElementById("toCalendar").addEventListener("click", ()=>{
  // ã“ã“ã¯ã‚ãªãŸã®æ§‹æˆã«åˆã‚ã›ã¦OKï¼ˆä»Šã¯ action.html ã«é£›ã°ã™ï¼‰
  location.href = "action.html";
});

editBtn.addEventListener("click", ()=> setEditing(!isEditing));
closeBtn.addEventListener("click", closeModal);
backBtn.addEventListener("click", closeModal);

addActionBtn.addEventListener("click", addAction);
resetBtn.addEventListener("click", resetActions);

modal.addEventListener("click", (e)=>{
  if(e.target === modal) closeModal();
});
document.addEventListener("keydown", (e)=>{
  if(e.key === "Escape") closeModal();
});

/* init */
renderGrid();
</script>
</body>
</html>
