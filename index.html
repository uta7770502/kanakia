<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ã‚«ãƒŠãƒªã‚¢é€šä¿¡ï½œæ´»å‹•ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</title>
  <style>
    :root{
      --bg:#f7f7fb;
      --card:#ffffff;
      --text:#1a1a1a;
      --muted:#6b7280;
      --line:#e5e7eb;
      --accent:#16a34a;
      --shadow: 0 8px 24px rgba(0,0,0,.08);
      --radius: 16px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", sans-serif;
      background: linear-gradient(180deg, #fff, var(--bg));
      color: var(--text);
    }
    .wrap{ max-width: 1100px; margin: 0 auto; padding: 18px 14px 40px; }

    /* Header */
    header{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; padding: 14px 12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
    }
    .logo{
      width:42px; height:42px; border-radius: 14px;
      background: radial-gradient(circle at 30% 30%, #ffe07a, #f7b500);
      display:grid; place-items:center; box-shadow: var(--shadow);
      font-size:22px;
    }
    h1{ font-size: 18px; margin:0; }
    .sub{ font-size: 12px; color: var(--muted); margin-top:2px; }
    .actions{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    button, select{
      border: 1px solid var(--line);
      background: #fff;
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 14px;
      cursor:pointer;
    }
    button.primary{
      border-color: transparent;
      background: var(--accent);
      color:#fff;
      font-weight:700;
    }
    button.ghost{ background:#fff; }

    /* Layout */
    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 14px;
    }
    @media (max-width: 900px){
      .grid{ grid-template-columns: 1fr; }
    }

    .panel{
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .panel h2{
      margin: 0 0 8px;
      font-size: 16px;
    }
    .hint{
      margin: 0 0 10px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
    }

    /* Activity cards */
    .chips{
      display:flex; gap:8px; flex-wrap:wrap;
      margin: 10px 0 6px;
    }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border:1px solid var(--line);
      background:#fff;
      cursor:pointer;
      user-select:none;
      font-size: 14px;
    }
    .chip[data-active="true"]{
      outline: 3px solid rgba(22,163,74,.18);
      border-color: rgba(22,163,74,.55);
    }
    .dot{
      width:10px; height:10px; border-radius: 999px;
      background: #999;
    }
    .chip .emoji{ font-size: 18px; }

    .legend{
      display:flex; gap:10px; flex-wrap:wrap;
      padding-top: 8px;
      border-top:1px dashed var(--line);
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
    }
    .legend .item{ display:flex; gap:6px; align-items:center; }

    /* Calendar */
    .cal-head{
      display:flex; align-items:center; justify-content:space-between;
      gap:8px; margin-bottom: 10px;
    }
    .month-title{ font-size: 16px; font-weight:800; }
    .cal-tools{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }

    .cal{
      width:100%;
      border-collapse: separate;
      border-spacing: 6px;
    }
    .cal th{
      font-size: 12px; color: var(--muted);
      padding: 6px 0;
      text-align:center;
    }
    .cell{
      background:#fff;
      border:1px solid var(--line);
      border-radius: 14px;
      min-height: 78px;
      padding: 8px;
      vertical-align: top;
      position:relative;
      cursor:pointer;
    }
    .cell[data-out="true"]{
      opacity:.35;
      cursor: default;
    }
    .daynum{
      font-weight:800;
      font-size: 13px;
    }
    .badge{
      margin-top: 8px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight:700;
      border:1px solid rgba(0,0,0,.06);
      background: rgba(0,0,0,.03);
    }
    .badge .emoji{ font-size: 15px; }

    .selected-date{
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px dashed var(--line);
      background: #fbfbff;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
    }

    .toast{
      margin-top: 10px;
      background:#0b1220;
      color:#fff;
      border-radius: 14px;
      padding: 10px 12px;
      display:none;
      font-size: 13px;
    }
    .toast.show{ display:block; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">ğŸ¤</div>
        <div>
          <h1>ã‚«ãƒŠãƒªã‚¢é€šä¿¡ï½œæ´»å‹•ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h1>
          <div class="sub">æ´»å‹•ã‚’é¸ã‚“ã§ã€æ—¥ä»˜ã«å‰²ã‚Šå½“ã¦ã‚‹ã ã‘ã€‚å°åˆ·ã‚„å…±æœ‰ã¯ã‚ã¨ã§è¿½åŠ ã§ãã¾ã™ã€‚</div>
        </div>
      </div>

      <div class="actions">
        <select id="monthPicker" aria-label="æœˆã‚’é¸ã¶"></select>
        <button class="ghost" id="btnClear">å…¨æ¶ˆå»</button>
        <button class="primary" id="btnSave">ã“ã®æœˆã‚’ä¿å­˜</button>
      </div>
    </header>

    <div class="grid">
      <!-- Left: Activities -->
      <section class="panel">
        <h2>â‘  æ´»å‹•ã‚’é¸ã¶</h2>
        <p class="hint">
          ã¾ãšæ´»å‹•ã‚’1ã¤é¸ã‚“ã§ãã ã•ã„ã€‚æ¬¡ã«ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€ãã®æ´»å‹•ãŒå…¥ã‚Šã¾ã™ã€‚<br>
          ï¼ˆä¾‹ï¼šğŸƒé‹å‹•ã‚’é¸ã¶ â†’ 1/7ã‚’ã‚¿ãƒƒãƒ— â†’ 1/7ãŒã€Œé‹å‹•ã€ã«ãªã‚‹ï¼‰
        </p>

        <div class="chips" id="activityChips"></div>

        <div class="legend" id="legend"></div>

        <div style="margin-top:12px;" class="selected-date" id="statusBox">
          é¸æŠä¸­ã®æ´»å‹•ï¼š<b id="currentAct">æœªé¸æŠ</b><br>
          ç›´è¿‘ã§é¸ã‚“ã æ—¥ä»˜ï¼š<b id="currentDate">ãªã—</b>
        </div>

        <div class="toast" id="toast"></div>
      </section>

      <!-- Right: Calendar -->
      <section class="panel">
        <div class="cal-head">
          <div class="month-title" id="monthTitle">----</div>
          <div class="cal-tools">
            <button class="ghost" id="prevMonth">â—€ å‰æœˆ</button>
            <button class="ghost" id="nextMonth">æ¬¡æœˆ â–¶</button>
          </div>
        </div>

        <table class="cal" id="calendarTable" aria-label="æ´»å‹•ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼">
          <thead>
            <tr>
              <th style="color:#ef4444">æ—¥</th>
              <th>æœˆ</th>
              <th>ç«</th>
              <th>æ°´</th>
              <th>æœ¨</th>
              <th>é‡‘</th>
              <th style="color:#3b82f6">åœŸ</th>
            </tr>
          </thead>
          <tbody id="calendarBody"></tbody>
        </table>

        <p class="hint" style="margin-top:10px;">
          â€»ã€Œä¿å­˜ã€ã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã«ä¿å­˜ï¼ˆç«¯æœ«ã”ã¨ï¼‰ã€‚å¾Œã§Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆé€£æºã‚‚å¯èƒ½ã€‚
        </p>
      </section>
    </div>
  </div>

<script>
  // =========================
  // æ´»å‹•ãƒã‚¹ã‚¿ï¼ˆã“ã“ã‚’å¢—ã‚„ã™ã ã‘ã§UIã«åæ˜ ã•ã‚Œã‚‹ï¼‰
  // =========================
  const ACTIVITIES = [
    { id:"off",   label:"ãŠä¼‘ã¿",     emoji:"ğŸ˜¶", color:"#9ca3af" },
    { id:"sport", label:"é‹å‹•",       emoji:"ğŸƒ", color:"#3b82f6" },
    { id:"craft", label:"å·¥ä½œ",       emoji:"ğŸ¨", color:"#f59e0b" },
    { id:"game",  label:"ãƒ«ãƒ¼ãƒ«ã‚²ãƒ¼ãƒ ", emoji:"ğŸ²", color:"#a855f7" },
    { id:"kara",  label:"ã‚«ãƒ©ã‚ªã‚±",   emoji:"ğŸ¤", color:"#ef4444" },
    { id:"study", label:"å­¦ç¿’",       emoji:"ğŸ“š", color:"#16a34a" },
    { id:"planet",label:"ãƒ—ãƒ©ãƒã‚¿ãƒªã‚¦ãƒ ",emoji:"ğŸª", color:"#0ea5e9" },
    { id:"prog",  label:"ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°",emoji:"ğŸ¤–", color:"#111827" },
  ];

  // =========================
  // çŠ¶æ…‹
  // =========================
  let selectedActivityId = null;
  let viewYear, viewMonth; // month: 0-11
  let assignments = {}; // { "YYYY-MM-DD": "activityId" }

  // localStorage keys
  const LS_PREFIX = "kanaria_calendar_v1";
  const monthKey = (y,m)=> `${LS_PREFIX}:${y}-${String(m+1).padStart(2,"0")}`;

  // DOM
  const monthPicker = document.getElementById("monthPicker");
  const activityChips = document.getElementById("activityChips");
  const legend = document.getElementById("legend");
  const monthTitle = document.getElementById("monthTitle");
  const calendarBody = document.getElementById("calendarBody");
  const currentAct = document.getElementById("currentAct");
  const currentDate = document.getElementById("currentDate");
  const toast = document.getElementById("toast");

  const btnSave = document.getElementById("btnSave");
  const btnClear = document.getElementById("btnClear");
  const prevMonthBtn = document.getElementById("prevMonth");
  const nextMonthBtn = document.getElementById("nextMonth");

  // =========================
  // Utils
  // =========================
  const pad2 = (n)=> String(n).padStart(2,"0");
  const ymd = (y,m,d)=> `${y}-${pad2(m+1)}-${pad2(d)}`;
  const findAct = (id)=> ACTIVITIES.find(a=>a.id===id);

  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add("show");
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=> toast.classList.remove("show"), 1800);
  }

  // =========================
  // åˆæœŸåŒ–ï¼šæœˆ
  // =========================
  function initMonthPicker(){
    // ä»Šå¹´Â±1å¹´ã‚’é¸ã¹ã‚‹ã‚ˆã†ã«
    const now = new Date();
    const baseYear = now.getFullYear();
    const options = [];
    for(let y=baseYear-1; y<=baseYear+1; y++){
      for(let m=0; m<12; m++){
        options.push({ y, m, label: `${y}å¹´ ${m+1}æœˆ` });
      }
    }
    monthPicker.innerHTML = options.map(o=>{
      const value = `${o.y}-${o.m}`;
      return `<option value="${value}">${o.label}</option>`;
    }).join("");

    viewYear = now.getFullYear();
    viewMonth = now.getMonth();
    monthPicker.value = `${viewYear}-${viewMonth}`;
  }

  function loadMonth(y,m){
    viewYear = y; viewMonth = m;
    monthPicker.value = `${y}-${m}`;
    monthTitle.textContent = `${y}å¹´ ${m+1}æœˆ`;

    // load assignments for month
    const raw = localStorage.getItem(monthKey(y,m));
    assignments = raw ? JSON.parse(raw) : {};
    renderCalendar();
  }

  // =========================
  // æ´»å‹•UI
  // =========================
  function renderActivities(){
    activityChips.innerHTML = ACTIVITIES.map(a=>{
      return `
        <div class="chip" data-id="${a.id}" data-active="false" title="${a.label}">
          <span class="emoji">${a.emoji}</span>
          <span>${a.label}</span>
          <span class="dot" style="background:${a.color}"></span>
        </div>
      `;
    }).join("");

    legend.innerHTML = ACTIVITIES.map(a=>{
      return `
        <div class="item">
          <span class="dot" style="background:${a.color}"></span>
          <span>${a.emoji} ${a.label}</span>
        </div>
      `;
    }).join("");

    activityChips.querySelectorAll(".chip").forEach(chip=>{
      chip.addEventListener("click", ()=>{
        const id = chip.dataset.id;
        selectActivity(id);
      });
    });
  }

  function selectActivity(id){
    selectedActivityId = id;
    activityChips.querySelectorAll(".chip").forEach(c=>{
      c.dataset.active = (c.dataset.id === id) ? "true" : "false";
    });
    const act = findAct(id);
    currentAct.textContent = act ? `${act.emoji} ${act.label}` : "æœªé¸æŠ";
  }

  // =========================
  // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æç”»
  // =========================
  function renderCalendar(){
    calendarBody.innerHTML = "";

    const first = new Date(viewYear, viewMonth, 1);
    const last  = new Date(viewYear, viewMonth+1, 0);
    const firstDow = first.getDay(); // 0=Sun

    let day = 1 - firstDow; // start from Sunday cell
    for(let r=0; r<6; r++){
      const tr = document.createElement("tr");

      for(let c=0; c<7; c++, day++){
        const td = document.createElement("td");
        td.className = "cell";

        const inMonth = (day>=1 && day<=last.getDate());
        td.dataset.out = inMonth ? "false" : "true";

        if(!inMonth){
          td.innerHTML = `<div class="daynum"></div>`;
          tr.appendChild(td);
          continue;
        }

        const key = ymd(viewYear, viewMonth, day);
        const assignedId = assignments[key];
        const assigned = assignedId ? findAct(assignedId) : null;

        td.innerHTML = `
          <div class="daynum">${day}</div>
          ${assigned ? `
            <div class="badge" style="background: color-mix(in oklab, ${assigned.color} 16%, #ffffff); border-color: color-mix(in oklab, ${assigned.color} 35%, #ffffff);">
              <span class="emoji">${assigned.emoji}</span>
              <span>${assigned.label}</span>
            </div>
          ` : ``}
        `;

        td.addEventListener("click", ()=>{
          if(!selectedActivityId){
            showToast("å…ˆã«ã€Œæ´»å‹•ã€ã‚’é¸ã‚“ã§ãã ã•ã„");
            return;
          }
          assignments[key] = selectedActivityId;
          const act = findAct(selectedActivityId);
          currentDate.textContent = `${viewYear}/${viewMonth+1}/${day}`;
          showToast(`${viewYear}/${viewMonth+1}/${day} ã«ã€Œ${act.label}ã€ã‚’å…¥ã‚Œã¾ã—ãŸ`);
          renderCalendar();
        });

        tr.appendChild(td);
      }

      calendarBody.appendChild(tr);

      // 6é€±ç›®ãŒä¸è¦ãªã‚‰breakï¼ˆæœ€å¾Œã®é€±ã«å½“æœˆæ—¥ä»˜ãŒ1ã¤ã‚‚ãªã„å ´åˆã¯çµ‚äº†ï¼‰
      const hasInMonth = Array.from(tr.children).some(td => td.dataset.out === "false");
      if(!hasInMonth) break;
    }
  }

  // =========================
  // ã‚¤ãƒ™ãƒ³ãƒˆ
  // =========================
  monthPicker.addEventListener("change", ()=>{
    const [yStr, mStr] = monthPicker.value.split("-");
    loadMonth(Number(yStr), Number(mStr));
  });

  prevMonthBtn.addEventListener("click", ()=>{
    let y=viewYear, m=viewMonth-1;
    if(m<0){ m=11; y--; }
    loadMonth(y,m);
  });

  nextMonthBtn.addEventListener("click", ()=>{
    let y=viewYear, m=viewMonth+1;
    if(m>11){ m=0; y++; }
    loadMonth(y,m);
  });

  btnSave.addEventListener("click", ()=>{
    localStorage.setItem(monthKey(viewYear, viewMonth), JSON.stringify(assignments));
    showToast("ã“ã®æœˆã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ˆã“ã®ç«¯æœ«ã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ï¼‰");
  });

  btnClear.addEventListener("click", ()=>{
    assignments = {};
    localStorage.removeItem(monthKey(viewYear, viewMonth));
    renderCalendar();
    showToast("ã“ã®æœˆã®å†…å®¹ã‚’å…¨æ¶ˆå»ã—ã¾ã—ãŸ");
  });

  // =========================
  // èµ·å‹•
  // =========================
  initMonthPicker();
  renderActivities();
  loadMonth(viewYear, viewMonth);

  // åˆæœŸé¸æŠï¼ˆä»»æ„ï¼‰ï¼šé‹å‹•
  selectActivity("sport");
</script>
</body>
</html>
