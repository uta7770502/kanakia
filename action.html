<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ã‚«ãƒŠãƒªã‚¢é€šä¿¡ï½œæ´»å‹•ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</title>

<style>
  :root{
    --bg:#f5f6f8;
    --card:#fff;
    --shadow:0 10px 22px rgba(0,0,0,.08);
    --header:#4fc3c7;
    --accent:#2fb34a;
    --accent2:#1aa65a;
    --line:#e9edf2;
    --text:#222;
    --muted:#6b7280;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif;
    background:var(--bg);
    color:var(--text);
  }
  header{
    background:var(--header);
    color:#fff;
    text-align:center;
    padding:16px 14px;
    font-size:20px;
    font-weight:800;
  }
  .wrap{ max-width: 980px; margin: 0 auto; }

  /* ä¸Šéƒ¨ï¼šã‚¿ã‚¤ãƒˆãƒ«/æ“ä½œ */
  .top{
    padding:14px 16px 8px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
  }
  .brand{ display:flex; gap:10px; align-items:flex-start; }
  .brand .bird{font-size:26px; line-height:1}
  .brand .t1{font-weight:900; font-size:16px}
  .brand .t2{color:var(--muted); font-size:12px; margin-top:2px}
  .controls{ display:flex; gap:10px; align-items:center; }
  select{
    border:1px solid var(--line);
    border-radius:12px;
    padding:8px 10px;
    background:#fff;
    font-weight:700;
  }
  .btn{
    border:none;
    border-radius:999px;
    padding:10px 14px;
    font-weight:900;
    cursor:pointer;
  }
  .btn.save{
    background:linear-gradient(135deg,var(--accent),var(--accent2));
    color:#fff;
    box-shadow:0 10px 18px rgba(47,179,74,.22);
  }
  .btn.ghost{
    background:#fff;
    border:1px solid var(--line);
    color:#111;
  }

  /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
  .section{
    background:var(--card);
    margin: 10px 16px;
    border-radius:18px;
    box-shadow: var(--shadow);
    padding:14px;
  }
  .section h3{
    margin:0 0 10px;
    font-size:16px;
    font-weight:900;
  }
  .help{
    color:var(--muted);
    font-size:12px;
    line-height:1.5;
    margin-bottom:10px;
  }

  /* â˜…ã‚¸ãƒ£ãƒ³ãƒ«ã¨ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®é–“ã®ãƒœã‚¿ãƒ³ */
  .between-actions{
    margin: 6px 16px 2px;
    display:flex;
    justify-content:center;
  }
  .previewBtn{
    width:min(520px, 100%);
    border:none;
    border-radius:999px;
    padding:14px 16px;
    font-weight:900;
    font-size:16px;
    cursor:pointer;
    color:#fff;
    background:linear-gradient(135deg,var(--accent),var(--accent2));
    box-shadow:0 14px 26px rgba(47,179,74,.22);
  }
  .previewBtn:active{ transform: translateY(1px); }

  /* 9ã‚¸ãƒ£ãƒ³ãƒ«ã‚°ãƒªãƒƒãƒ‰ï¼ˆãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¨åŒãƒ†ã‚¤ã‚¹ãƒˆï¼‰ */
  .genre-grid{
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 14px;
  }
  .genre-item{
    background:#fff;
    border:1px solid var(--line);
    border-radius:18px;
    padding:14px 8px 12px;
    text-align:center;
    box-shadow:0 6px 14px rgba(0,0,0,0.06);
    cursor:pointer;
    user-select:none;
  }
  .genre-item:active{ transform: translateY(1px); }
  .genre-icon{
    width: 62px;
    height: 62px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:30px;
    margin: 0 auto 8px;
  }
  .genre-label{
    font-size:13px;
    font-weight:900;
  }

  /* è‰² */
  .bg-orange{ background:#ff8a65; }
  .bg-purple{ background:#9575cd; }
  .bg-teal  { background:#4db6ac; }
  .bg-yellow{ background:#fbc02d; }
  .bg-green { background:#81c784; }
  .bg-brown { background:#ffb74d; }
  .bg-blue  { background:#64b5f6; }
  .bg-lime  { background:#aed581; }
  .bg-gray  { background:#90a4ae; }

  /* çŠ¶æ…‹è¡¨ç¤º */
  .status{
    margin-top:10px;
    padding-top:10px;
    border-top:1px dashed var(--line);
    font-size:13px;
    color:#111;
  }
  .status .muted{color:var(--muted)}
  .pill{
    display:inline-flex;
    gap:6px;
    align-items:center;
    border:1px solid var(--line);
    border-radius:999px;
    padding:6px 10px;
    background:#fff;
    font-weight:900;
    margin-left:6px;
  }

  /* ===== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ===== */
  .cal-head{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    margin-bottom:10px;
  }
  .cal-title{
    font-weight:900;
    font-size:16px;
  }
  .nav{ display:flex; gap:8px; }
  .nav .btn{
    padding:8px 12px;
    font-weight:900;
    border-radius:12px;
  }
  .week{
    display:grid;
    grid-template-columns: repeat(7, 1fr);
    gap:6px;
    margin-bottom:6px;
    font-size:12px;
    font-weight:900;
    color:var(--muted);
    text-align:center;
  }
  .days{
    display:grid;
    grid-template-columns: repeat(7, 1fr);
    gap:6px;
  }
  .day{
    background:#f9fafb;
    border:1px solid var(--line);
    border-radius:14px;
    min-height:74px;
    padding:7px;
    position:relative;
    cursor:pointer;
    overflow:hidden;
  }
  .day.empty{
    background:transparent;
    border:none;
    cursor:default;
  }
  .dnum{
    font-weight:900;
    font-size:13px;
  }
  .tag{
    margin-top:6px;
    display:flex;
    align-items:center;
    gap:6px;
    border-radius:999px;
    padding:6px 8px;
    font-size:12px;
    font-weight:900;
    width: fit-content;
    max-width: 100%;
    background:#fff;
    border:1px solid var(--line);
  }
  .tag .emo{font-size:14px}
  .tag .txt{
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    max-width: 90px;
  }

  /* ã‚¿ã‚°è‰²ï¼ˆã‚¸ãƒ£ãƒ³ãƒ«ã«åˆã‚ã›ã‚‹ï¼‰ */
  .t-orange{ background:rgba(255,138,101,.22); border-color:rgba(255,138,101,.35); }
  .t-purple{ background:rgba(149,117,205,.22); border-color:rgba(149,117,205,.35); }
  .t-teal  { background:rgba(77,182,172,.22);  border-color:rgba(77,182,172,.35); }
  .t-yellow{ background:rgba(251,192,45,.22);  border-color:rgba(251,192,45,.35); }
  .t-green { background:rgba(129,199,132,.22); border-color:rgba(129,199,132,.35); }
  .t-brown { background:rgba(255,183,77,.22);  border-color:rgba(255,183,77,.35); }
  .t-blue  { background:rgba(100,181,246,.22); border-color:rgba(100,181,246,.35); }
  .t-lime  { background:rgba(174,213,129,.22); border-color:rgba(174,213,129,.35); }
  .t-gray  { background:rgba(144,164,174,.22); border-color:rgba(144,164,174,.35); }

  .hint{
    margin-top:10px;
    color:var(--muted);
    font-size:12px;
  }

  /* ===== ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ï¼‰ ===== */
  .modal{
    position:fixed;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    padding:18px;
    background:rgba(0,0,0,.35);
    z-index:9999;
  }
  .modal.show{ display:flex; }
  .modal-card{
    width:min(560px, 100%);
    background:#fff;
    border-radius:18px;
    box-shadow:0 18px 40px rgba(0,0,0,.2);
    overflow:hidden;
  }
  .modal-head{
    padding:14px 14px 12px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    border-bottom:1px solid var(--line);
  }
  .modal-title{
    display:flex; align-items:center; gap:10px;
    font-weight:900;
  }
  .badge{
    width:36px;height:36px;border-radius:50%;
    display:flex;align-items:center;justify-content:center;
    font-size:18px;color:#111;
  }
  .modal-body{
    padding:14px;
  }
  .action6{
    display:grid;
    grid-template-columns: repeat(2, 1fr);
    gap:12px;
  }
  .act-btn{
    border:1px solid var(--line);
    background:#fff;
    border-radius:16px;
    padding:12px 12px;
    text-align:left;
    display:flex;
    gap:10px;
    align-items:center;
    cursor:pointer;
    box-shadow:0 6px 14px rgba(0,0,0,.06);
  }
  .act-btn:active{ transform: translateY(1px); }
  .act-emo{
    width:42px;height:42px;border-radius:14px;
    display:flex;align-items:center;justify-content:center;
    font-size:20px;
    flex:0 0 auto;
  }
  .act-name{
    font-weight:900;
    font-size:14px;
    line-height:1.2;
  }
  .act-sub{
    font-size:12px;
    color:var(--muted);
    margin-top:2px;
  }
  .modal-foot{
    padding:12px 14px 14px;
    border-top:1px solid var(--line);
    display:flex;
    justify-content:flex-end;
    gap:10px;
  }
  .btn.close{
    background:#fff;
    border:1px solid var(--line);
    color:#111;
  }

  @media (max-width:420px){
    .action6{ grid-template-columns: 1fr; }
  }
</style>
</head>

<body>
<header>ã‚«ãƒŠãƒªã‚¢é€šä¿¡ï½œæ´»å‹•ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</header>

<div class="wrap">
  <div class="top">
    <div class="brand">
      <div class="bird">ğŸ¤</div>
      <div>
        <div class="t1">ã‚«ãƒŠãƒªã‚¢é€šä¿¡ï½œæ´»å‹•ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</div>
        <div class="t2">ã‚¸ãƒ£ãƒ³ãƒ«ã‚’æŠ¼ã™ â†’ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‹ã‚‰æ´»å‹•ã‚’é¸ã¶ â†’ æ—¥ä»˜ã‚’ã‚¿ãƒƒãƒ—ã§åæ˜ </div>
      </div>
    </div>

    <div class="controls">
      <select id="monthSelect"></select>
      <button class="btn ghost" id="clearBtn">å…¨æ¶ˆå»</button>
      <button class="btn save" id="saveBtn">ã“ã®æœˆã‚’ä¿å­˜</button>
    </div>
  </div>

  <!-- â‘  ã‚¸ãƒ£ãƒ³ãƒ«ã‚’é¸ã¶ -->
  <div class="section">
    <h3>â‘  æ´»å‹•ã‚¸ãƒ£ãƒ³ãƒ«ã‚’é¸ã¶</h3>
    <div class="help">
      9ã¤ã®ã‚¸ãƒ£ãƒ³ãƒ«ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒé–‹ãã¾ã™ã€‚ãã“ã§6ã¤ã®æ´»å‹•ã‹ã‚‰1ã¤é¸ã¶ã¨ã€Œé¸æŠä¸­ã®æ´»å‹•ã€ã«ãªã‚Šã¾ã™ã€‚<br>
      ãã®ã‚ã¨ã€ä¸‹ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨åæ˜ ã•ã‚Œã¾ã™ã€‚
    </div>

    <div class="genre-grid" id="genreGrid"></div>

    <div class="status">
      <span class="muted">é¸æŠä¸­ã®æ´»å‹•ï¼š</span>
      <span class="pill" id="currentPill">ãªã—</span><br>
      <span class="muted">ç›´è¿‘ã§é¸ã‚“ã æ—¥ä»˜ï¼š</span>
      <span id="lastDate">ãªã—</span>
    </div>
  </div>

  <!-- â˜…ã“ã“ãŒã€Œã‚¸ãƒ£ãƒ³ãƒ«ã¨ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®é–“ã€ -->
  <div class="between-actions">
    <button id="previewBtn" class="previewBtn">é…å¸ƒç¢ºèªã¸</button>
  </div>

  <!-- â‘¡ æ—¥ä»˜ã‚’é¸ã¶ -->
  <div class="section">
    <div class="cal-head">
      <div class="cal-title" id="calTitle">2025å¹´12æœˆ</div>
      <div class="nav">
        <button class="btn ghost" id="prevBtn">â—€ å‰æœˆ</button>
        <button class="btn ghost" id="nextBtn">æ¬¡æœˆ â–¶</button>
      </div>
    </div>

    <div class="week">
      <div style="color:#ef4444">æ—¥</div><div>æœˆ</div><div>ç«</div><div>æ°´</div><div>æœ¨</div><div>é‡‘</div><div style="color:#3b82f6">åœŸ</div>
    </div>
    <div class="days" id="days"></div>

    <div class="hint">â€» å…ˆã«æ´»å‹•ã‚’é¸ã‚“ã§ã‹ã‚‰æ—¥ä»˜ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚ã‚¿ãƒƒãƒ—ã§ä¸Šæ›¸ãã§ãã¾ã™ã€‚</div>
  </div>
</div>

<!-- ===== ãƒ¢ãƒ¼ãƒ€ãƒ« ===== -->
<div class="modal" id="modal">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-head">
      <div class="modal-title" id="modalTitleWrap">
        <div class="badge" id="modalBadge">ğŸ¯</div>
        <div id="modalTitle">æ´»å‹•ã‚’é¸ã¶</div>
      </div>
      <button class="btn close" id="modalX" style="padding:8px 12px;border-radius:12px;">é–‰ã˜ã‚‹</button>
    </div>
    <div class="modal-body">
      <div class="help" id="modalHelp" style="margin:0 0 10px;">
        6ã¤ã®æ´»å‹•ã‹ã‚‰é¸ã‚“ã§ãã ã•ã„ã€‚é¸ã¶ã¨ã€Œé¸æŠä¸­ã®æ´»å‹•ã€ã«ã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚
      </div>
      <div class="action6" id="modalActions"></div>
    </div>
    <div class="modal-foot">
      <button class="btn close" id="modalBack">ã“ã®ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</button>
    </div>
  </div>
</div>

<script>
/* ============================
   9ã‚¸ãƒ£ãƒ³ãƒ« + å„ã‚¸ãƒ£ãƒ³ãƒ«6ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
============================ */
const GENRES = [
  { id:"sport", label:"é‹å‹•", emoji:"ğŸƒ", iconBg:"bg-orange", tag:"t-orange",
    actions:[
      { id:"sport-run",   label:"ã‹ã‘ã£ã“", emoji:"ğŸƒâ€â™‚ï¸", sub:"ä½“åŠ›ã¥ãã‚Š" },
      { id:"sport-ball",  label:"ãƒœãƒ¼ãƒ«éŠã³", emoji:"âš½ï¸", sub:"å”èª¿ãƒ»ãƒ«ãƒ¼ãƒ«" },
      { id:"sport-dance", label:"ãƒ€ãƒ³ã‚¹", emoji:"ğŸ’ƒ", sub:"ãƒªã‚ºãƒ ãƒ»è¡¨ç¾" },
      { id:"sport-gym",   label:"ã‚µãƒ¼ã‚­ãƒƒãƒˆ", emoji:"ğŸ¤¸", sub:"é‹å‹•æ©Ÿèƒ½" },
      { id:"sport-walk",  label:"æ•£æ­©", emoji:"ğŸš¶", sub:"æ°—åˆ†è»¢æ›" },
      { id:"sport-game",  label:"é‹å‹•ã‚²ãƒ¼ãƒ ", emoji:"ğŸ¸", sub:"æ¥½ã—ãé‹å‹•" },
    ]},
  { id:"finger", label:"æŒ‡å…ˆèª²é¡Œ", emoji:"âœ‹", iconBg:"bg-purple", tag:"t-purple",
    actions:[
      { id:"finger-cut",  label:"ã¯ã•ã¿", emoji:"âœ‚ï¸", sub:"å·§ç·»æ€§" },
      { id:"finger-fold", label:"æŠ˜ã‚Šç´™", emoji:"ğŸ“„", sub:"æ‰‹é †ãƒ»é›†ä¸­" },
      { id:"finger-bead", label:"ã²ã‚‚é€šã—", emoji:"ğŸ§µ", sub:"æŒ‡å…ˆæ“ä½œ" },
      { id:"finger-peg",  label:"æ´—æ¿¯ã°ã•ã¿", emoji:"ğŸ“", sub:"ã¤ã¾ã‚€ç·´ç¿’" },
      { id:"finger-clay", label:"ç²˜åœŸ", emoji:"ğŸ§±", sub:"æ¡ã‚‹ãƒ»ã“ã­ã‚‹" },
      { id:"finger-puzzle",label:"ãƒ‘ã‚ºãƒ«", emoji:"ğŸ§©", sub:"å½¢åˆã‚ã›" },
    ]},
  { id:"focus", label:"é›†ä¸­èª²é¡Œ", emoji:"ğŸ§ ", iconBg:"bg-teal", tag:"t-teal",
    actions:[
      { id:"focus-worksheet", label:"ãƒ¯ãƒ¼ã‚¯", emoji:"ğŸ“", sub:"æœºä¸Šèª²é¡Œ" },
      { id:"focus-maze",      label:"è¿·è·¯", emoji:"ğŸŒ€", sub:"æ³¨æ„ãƒ»è¨ˆç”»" },
      { id:"focus-math",      label:"æ•°ã‚ãã³", emoji:"ğŸ”¢", sub:"æ•°æ¦‚å¿µ" },
      { id:"focus-letter",    label:"ã“ã¨ã°", emoji:"ğŸ”¤", sub:"æ–‡å­—" },
      { id:"focus-memory",    label:"è¨˜æ†¶ã‚²ãƒ¼ãƒ ", emoji:"ğŸ§ ", sub:"è¨˜æ†¶ãƒ»é›†ä¸­" },
      { id:"focus-time",      label:"æ™‚è¨ˆ", emoji:"ğŸ•’", sub:"æ™‚é–“ç†è§£" },
    ]},
  { id:"craft", label:"å·¥ä½œ", emoji:"ğŸ¨", iconBg:"bg-yellow", tag:"t-yellow",
    actions:[
      { id:"craft-paint", label:"ã¬ã‚Šçµµ", emoji:"ğŸ–ï¸", sub:"è¡¨ç¾" },
      { id:"craft-paper", label:"ç´™å·¥ä½œ", emoji:"ğŸ“", sub:"åˆ¶ä½œ" },
      { id:"craft-season",label:"å­£ç¯€åˆ¶ä½œ", emoji:"ğŸ", sub:"è¡Œäº‹" },
      { id:"craft-collage",label:"ã‚³ãƒ©ãƒ¼ã‚¸ãƒ¥", emoji:"ğŸ“°", sub:"è²¼ã‚‹" },
      { id:"craft-mask",  label:"ãŠé¢", emoji:"ğŸ­", sub:"ã”ã£ã“éŠã³" },
      { id:"craft-card",  label:"ã‚«ãƒ¼ãƒ‰ä½œã‚Š", emoji:"ğŸ’Œ", sub:"ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ" },
    ]},
  { id:"cook", label:"æ–™ç†", emoji:"ğŸ³", iconBg:"bg-green", tag:"t-green",
    actions:[
      { id:"cook-sand", label:"ã‚µãƒ³ãƒ‰", emoji:"ğŸ¥ª", sub:"ã‹ã‚“ãŸã‚“èª¿ç†" },
      { id:"cook-salad",label:"ã‚µãƒ©ãƒ€", emoji:"ğŸ¥—", sub:"æ··ãœã‚‹" },
      { id:"cook-onigiri",label:"ãŠã«ãã‚Š", emoji:"ğŸ™", sub:"æ¡ã‚‹" },
      { id:"cook-soup", label:"ã‚¹ãƒ¼ãƒ—", emoji:"ğŸ²", sub:"æ‰‹é †" },
      { id:"cook-egg",  label:"ãŸã¾ã”", emoji:"ğŸ³", sub:"åŠ ç†±" },
      { id:"cook-fruit",label:"ãƒ•ãƒ«ãƒ¼ãƒ„", emoji:"ğŸ", sub:"åˆ‡ã‚‹" },
    ]},
  { id:"snack", label:"ãŠã‚„ã¤ä½œã‚Š", emoji:"ğŸª", iconBg:"bg-brown", tag:"t-brown",
    actions:[
      { id:"snack-cookie", label:"ã‚¯ãƒƒã‚­ãƒ¼", emoji:"ğŸª", sub:"ã“ã­ã‚‹" },
      { id:"snack-jelly",  label:"ã‚¼ãƒªãƒ¼", emoji:"ğŸ®", sub:"å†·ã‚„ã™" },
      { id:"snack-parfait",label:"ãƒ‘ãƒ•ã‚§", emoji:"ğŸ¨", sub:"ç››ã‚Šä»˜ã‘" },
      { id:"snack-pancake",label:"ãƒ›ãƒƒãƒˆã‚±ãƒ¼ã‚­", emoji:"ğŸ¥", sub:"ç„¼ã" },
      { id:"snack-choco",  label:"ãƒãƒ§ã‚³", emoji:"ğŸ«", sub:"å›ºã‚ã‚‹" },
      { id:"snack-popcorn",label:"ãƒãƒƒãƒ—ã‚³ãƒ¼ãƒ³", emoji:"ğŸ¿", sub:"æ¥½ã—ã„" },
    ]},
  { id:"rule", label:"ãƒ«ãƒ¼ãƒ«ã‚²ãƒ¼ãƒ ", emoji:"ğŸ²", iconBg:"bg-blue", tag:"t-blue",
    actions:[
      { id:"rule-uno",   label:"ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ", emoji:"ğŸƒ", sub:"é †ç•ª" },
      { id:"rule-board", label:"ãƒœãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ", emoji:"ğŸ²", sub:"ãƒ«ãƒ¼ãƒ«" },
      { id:"rule-karuta",label:"ã‹ã‚‹ãŸ", emoji:"ğŸ€„ï¸", sub:"èã" },
      { id:"rule-jenga", label:"ãƒãƒ©ãƒ³ã‚¹", emoji:"ğŸ§±", sub:"æ‰‹å…ˆ" },
      { id:"rule-shiritori",label:"ã—ã‚Šã¨ã‚Š", emoji:"ğŸ—£ï¸", sub:"è¨€è‘‰" },
      { id:"rule-team",  label:"ãƒãƒ¼ãƒ æˆ¦", emoji:"ğŸ¤", sub:"å”åŠ›" },
    ]},
  { id:"life", label:"ç”Ÿæ´»å­¦ç¿’", emoji:"ğŸ ", iconBg:"bg-lime", tag:"t-lime",
    actions:[
      { id:"life-clean",  label:"æƒé™¤", emoji:"ğŸ§¹", sub:"ç‰‡ä»˜ã‘" },
      { id:"life-laundry",label:"æ´—æ¿¯", emoji:"ğŸ‘•", sub:"ãŸãŸã‚€" },
      { id:"life-money",  label:"ãŠé‡‘", emoji:"ğŸ’´", sub:"è²·ã„ç‰©ç·´ç¿’" },
      { id:"life-traffic",label:"äº¤é€š", emoji:"ğŸš¦", sub:"å®‰å…¨" },
      { id:"life-manner", label:"ãƒãƒŠãƒ¼", emoji:"ğŸ™‡", sub:"ç¤¾ä¼šæ€§" },
      { id:"life-time",   label:"æ™‚é–“", emoji:"â°", sub:"äºˆå®š" },
    ]},
  { id:"out", label:"å¤–å‡º", emoji:"ğŸšŒ", iconBg:"bg-gray", tag:"t-gray",
    actions:[
      { id:"out-park",   label:"å…¬åœ’", emoji:"ğŸ›", sub:"éŠå…·" },
      { id:"out-walk",   label:"æ•£ç­–", emoji:"ğŸŒ¿", sub:"è‡ªç„¶" },
      { id:"out-library",label:"å›³æ›¸é¤¨", emoji:"ğŸ“š", sub:"é™ã‹ã«" },
      { id:"out-shop",   label:"è²·ã„ç‰©", emoji:"ğŸ›’", sub:"å®Ÿè·µ" },
      { id:"out-museum", label:"è¦‹å­¦", emoji:"ğŸ›ï¸", sub:"å­¦ã³" },
      { id:"out-train",  label:"ä¹—ã‚Šç‰©", emoji:"ğŸšƒ", sub:"ä½“é¨“" },
    ]},
];

const genreById = Object.fromEntries(GENRES.map(g => [g.id, g]));

/* ===== çŠ¶æ…‹ ===== */
let current = null;
let viewY = 2025;
let viewM = 12;
let lastPicked = "ãªã—";

/* ===== ä¿å­˜ã‚­ãƒ¼ ===== */
function keyOf(y,m){ return `kanakia_${y}-${String(m).padStart(2,"0")}`; }

/* ===== æœˆã‚»ãƒ¬ã‚¯ãƒˆ ===== */
function buildMonthSelect(){
  const sel = document.getElementById("monthSelect");
  sel.innerHTML = "";
  const base = new Date();
  const start = new Date(base.getFullYear(), base.getMonth()-12, 1);
  for(let i=0;i<36;i++){
    const d = new Date(start.getFullYear(), start.getMonth()+i, 1);
    const y = d.getFullYear();
    const m = d.getMonth()+1;
    const opt = document.createElement("option");
    opt.value = `${y}-${m}`;
    opt.textContent = `${y}å¹´${m}æœˆ`;
    sel.appendChild(opt);
  }
  sel.value = `${viewY}-${viewM}`;
  sel.addEventListener("change", ()=>{
    const [y,m] = sel.value.split("-").map(Number);
    viewY = y; viewM = m;
    renderCalendar();
  });
}

/* ===== 9ã‚¸ãƒ£ãƒ³ãƒ«æç”» ===== */
function renderGenres(){
  const grid = document.getElementById("genreGrid");
  grid.innerHTML = "";
  GENRES.forEach(g=>{
    const item = document.createElement("div");
    item.className = "genre-item";
    item.innerHTML = `
      <div class="genre-icon ${g.iconBg}">${g.emoji}</div>
      <div class="genre-label">${g.label}</div>
    `;
    item.addEventListener("click", ()=>openModal(g.id));
    grid.appendChild(item);
  });
}

/* ===== ãƒ¢ãƒ¼ãƒ€ãƒ« ===== */
const modal = document.getElementById("modal");
const modalTitle = document.getElementById("modalTitle");
const modalBadge = document.getElementById("modalBadge");
const modalActions = document.getElementById("modalActions");

function openModal(genreId){
  const g = genreById[genreId];
  if(!g) return;

  modalTitle.textContent = `${g.label}ï½œæ´»å‹•ã‚’é¸ã¶`;
  modalBadge.textContent = g.emoji;
  modalBadge.className = `badge ${g.iconBg}`;

  modalActions.innerHTML = "";
  g.actions.forEach(a=>{
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "act-btn";
    btn.innerHTML = `
      <div class="act-emo ${g.iconBg}">${a.emoji}</div>
      <div>
        <div class="act-name">${a.label}</div>
        <div class="act-sub">${a.sub || ""}</div>
      </div>
    `;
    btn.addEventListener("click", ()=>{
      current = { genreId: g.id, actionId: a.id };
      updateStatus();
      closeModal();
    });
    modalActions.appendChild(btn);
  });

  modal.classList.add("show");
}

function closeModal(){ modal.classList.remove("show"); }

document.getElementById("modalX").addEventListener("click", closeModal);
document.getElementById("modalBack").addEventListener("click", closeModal);
modal.addEventListener("click", (e)=>{ if(e.target === modal) closeModal(); });
document.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeModal(); });

/* ===== çŠ¶æ…‹è¡¨ç¤º ===== */
function updateStatus(){
  const pill = document.getElementById("currentPill");
  if(!current){
    pill.textContent = "ãªã—";
  }else{
    const g = genreById[current.genreId];
    const a = g.actions.find(x=>x.id===current.actionId);
    pill.textContent = `${a.emoji} ${a.label}`;
  }
  document.getElementById("lastDate").textContent = lastPicked;
}

/* ===== ä¿å­˜ãƒ‡ãƒ¼ã‚¿ ===== */
function loadMonth(y,m){
  try{
    const raw = localStorage.getItem(keyOf(y,m));
    return raw ? JSON.parse(raw) : {};
  }catch(e){
    return {};
  }
}
function saveMonth(y,m,map){
  localStorage.setItem(keyOf(y,m), JSON.stringify(map));
}

/* ===== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æç”» ===== */
function renderCalendar(){
  document.getElementById("calTitle").textContent = `${viewY}å¹´${viewM}æœˆ`;
  document.getElementById("monthSelect").value = `${viewY}-${viewM}`;

  const daysEl = document.getElementById("days");
  daysEl.innerHTML = "";

  const first = new Date(viewY, viewM-1, 1);
  const last = new Date(viewY, viewM, 0);
  const startDow = first.getDay();
  const total = last.getDate();

  const map = loadMonth(viewY, viewM);

  for(let i=0;i<startDow;i++){
    const empty = document.createElement("div");
    empty.className = "day empty";
    daysEl.appendChild(empty);
  }

  for(let d=1; d<=total; d++){
    const cell = document.createElement("div");
    cell.className = "day";
    const iso = `${viewY}-${String(viewM).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    cell.innerHTML = `<div class="dnum">${d}</div>`;

    const saved = map[iso];
    if(saved && saved.genreId && saved.actionId && genreById[saved.genreId]){
      const g = genreById[saved.genreId];
      const a = g.actions.find(x=>x.id===saved.actionId);
      if(a){
        const tag = document.createElement("div");
        tag.className = `tag ${g.tag}`;
        tag.innerHTML = `<span class="emo">${a.emoji}</span><span class="txt">${a.label}</span>`;
        cell.appendChild(tag);
      }
    }

    cell.addEventListener("click", ()=>{
      if(!current){
        alert("å…ˆã«ã‚¸ãƒ£ãƒ³ãƒ«ã‚’æŠ¼ã—ã¦ã€æ´»å‹•ã‚’é¸ã‚“ã§ãã ã•ã„");
        return;
      }
      map[iso] = { genreId: current.genreId, actionId: current.actionId };
      saveMonth(viewY, viewM, map);
      lastPicked = `${viewM}/${d}`;
      renderCalendar();
      updateStatus();
    });

    daysEl.appendChild(cell);
  }
}

/* ===== å…¨æ¶ˆå» ===== */
function clearMonth(){
  if(!confirm("ã“ã®æœˆã®å…¥åŠ›ã‚’å…¨ã¦æ¶ˆã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) return;
  localStorage.removeItem(keyOf(viewY, viewM));
  renderCalendar();
}

/* ===== ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¸ï¼ˆâ˜…ã“ã“ãŒé‡è¦ï¼špreview.html ã«é£›ã°ã™ï¼‰ ===== */
function goPreview(){
  location.href = `preview.html?y=${viewY}&m=${viewM}`;
}

/* ===== æœˆç§»å‹• ===== */
function shiftMonth(delta){
  const d = new Date(viewY, viewM-1 + delta, 1);
  viewY = d.getFullYear();
  viewM = d.getMonth()+1;
  renderCalendar();
}

/* ===== åˆæœŸåŒ– ===== */
buildMonthSelect();
renderGenres();
renderCalendar();
updateStatus();

document.getElementById("clearBtn").addEventListener("click", clearMonth);
document.getElementById("saveBtn").addEventListener("click", goPreview);
document.getElementById("previewBtn").addEventListener("click", goPreview);
document.getElementById("prevBtn").addEventListener("click", ()=>shiftMonth(-1));
document.getElementById("nextBtn").addEventListener("click", ()=>shiftMonth(1));
</script>

</body>
</html>
